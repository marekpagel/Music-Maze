<!DOCTYPE>
<html>
	<head>
		<title>Music Maze</title>
		<script type="text/javascript" src="lib/three.r73.js"></script>
		<script type="text/javascript" src="lib/THREEx.KeyboardState.js"></script>
		<script type="text/javascript" src="src/maze.js"></script>
		<script type="text/javascript" src="src/camera.js"></script>
		<script type="text/javascript">

			var renderer, scene, camera, maze, cameraControls;

			function toRad(degree) {
				return Math.PI * 2 * degree / 360;
			}
		
			function onLoad() { 
				var canvasContainer = document.getElementById('myCanvasContainer'); 
				var width = 800; 
				var height = 500;
				
				renderer = new THREE.WebGLRenderer(); 
				renderer.setSize(width, height);
				renderer.gammaInput = true;
				renderer.gammaOutput = true;
				canvasContainer.appendChild(renderer.domElement);
				
				scene = new THREE.Scene();

				var directionalLight = new THREE.DirectionalLight(0xffffff);
				directionalLight.position.set(1, 1, 1);
				scene.add(directionalLight);
				
				camera = new THREE.PerspectiveCamera(80, width / height, 1, 1000);
				camera.position.set(0,0,95);
				camera.up = new THREE.Vector3(0,1,0);
				
				cameraControls = DebugCamera(camera, new THREEx.KeyboardState());
				
				var textureLoader = new THREE.TextureLoader();
				textureLoader.crossOrigin = 'Anonymous';
	
				maze = Maze(scene, textureLoader);
				
				//maze.next([0,0,0],[0,0,0], [1/3, 1/3, 1/3]);
				
				var positions = maze.next([0,0,0],[0,0,0], [1, 0, 0]);
				// TODO choose next position at random
				//      then move camera to that position
				//      then figure out prob distribution for the 3 connectors (left, right, front)
				//      (based on some music analysis procedure)
				//      then pass that to maze.next(); and recurse
				// TODO probably should move this proc into draw();

				maze.next([-100,0,60],[0,Math.PI/2,0], [1, 0, 0]);
				maze.next([-40,0,80],[0,0,0], [0, 1, 0]);
				maze.next([-20,0,140],[0,Math.PI/2,0], [0, 0, 0]);
				
				draw();
			}
			
			function draw() {
				requestAnimationFrame(draw);
				
				cameraControls.move();
				
				renderer.render(scene, camera);
			}
		</script>
	</head>
	<body onload="onLoad()">
		<div id="myCanvasContainer"></div>
	</body>
</html>
